{% extends 'libro/base.html' %}

{% block title %}
    <title>Fabulivum - {{ capitulo.titulo }}</title>
    <meta name="author" content="Javier Farré Avilés, {{ capitulo.autor.username }}">
{% endblock %}

{% block content %}
    <h1>{{ capitulo.titulo }}</h1>
    <h2><a href="{% url 'libro' pk=capitulo.libro.pk %}">{{ capitulo.libro.titulo }}</a> - {{ capitulo.autor.username }}</h2>
    {% for precuela in secuela_de %}
        {% if precuela.numero < capitulo.numero %}
            <p><a href="{% url 'capitulo' pk=precuela.pk %}">{{ precuela.titulo }}</a></p>
        {% endif %}
    {% endfor %}
    <p>{{ capitulo.texto_principal|linebreaks }}</p>
    {% for secuela in secuela_de %}
        {% if secuela.numero > capitulo.numero %}
            {% if user in lectores or user is capitulo.autor %}
                <p><a href="{% url 'capitulo' pk=secuela.pk %}">{{ secuela.titulo }}</a></p>
            {% elif user.is_authenticated %}
                <p><form action="{% url 'capitulo_leido' pk=capitulo.pk aux=secuela.pk %}" method="post">
                    {% csrf_token %}<button>{{ secuela.titulo }}</button>
                </form></p>
            {% endif %}
        {% endif %}
    {% empty %}
        {% if user in lectores or user is capitulo.autor or not user.is_authenticated %}
            <p><a href="{% url 'libro' pk=capitulo.libro.pk %}">Capitulo terminado</a></p>
        {% else %}
            <p><form action="{% url 'capitulo_leido' pk=capitulo.pk aux=0 %}" method="post">
                {% csrf_token %}<button>Capitulo terminado</button>
            </form></p>
        {% endif %}
    {% endfor %}
{% endblock %}